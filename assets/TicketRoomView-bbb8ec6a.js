import{u as M,_ as E}from"./LoadingCircleIcon-b3342dca.js";import{_ as U}from"./ToastModal-db6e1d86.js";import{K as L,z as B,h as n,j as D,i as m,x as K,o as a,c as l,a as t,f as S,n as Y,l as $,t as C,e as g,p as x,g as q,q as z,s as F}from"./index-dd941b0f.js";const{VITE_TURNSTILE_SITE_KEY:I}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},P="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=loadTurnstile",u=document.createElement("script");u.setAttribute("src",P);function G(r,c){if(!I)throw new Error("turnstileSiteKey is required for loadTurnstile");if(!r)throw new Error("selector is required for loadTurnstile");document.head.contains(u)||document.head.appendChild(u),window.loadTurnstile=()=>{window.turnstile.render(r,{sitekey:I,callback:c})}}function J(){document.head.contains(u)&&document.head.removeChild(u)}function Q(){L(()=>J());let r=null;return{render:c=>{r=new Promise(d=>{G(c,d)})},token:()=>r,clear:()=>{r=null}}}const W={key:0,class:"flex flex-wrap w-full justify-center bg-white py-20"},X={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},Z={key:2,class:"flex flex-wrap w-full justify-center bg-white py-20"},ee={class:"flex justify-center my-16"},te={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},se={class:"flex justify-center md:justify-end -mt-16"},ae=["alt","src"],oe={class:"text-gray-800 text-3xl font-semibold"},ne={class:"text-sm font-normal"},le={key:0},re={class:"w-full my-4 text-gray-600 flex rounded bg-white shadow-md"},ie=["value"],ce={key:1},ue=["innerHTML"],de={class:"flex justify-end mt-8"},fe=["disabled"],pe={key:1},he={__name:"TicketRoomView",setup(r){const c=B(),d=M(),T=Q(),{roomCode:_}=c.params,v=n(!1),h=n(!1),k=n(!1),f=n(!1),y=n(!1),i=n(""),b=n(""),p=n(""),o=D({label:"",description:"",backgroundImage:"",pageUrl:""}),A=m(()=>p.value!==""),V=m(()=>{const s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},{description:e}=o;return e==null?void 0:e.replace(/[&<>"']/g,w=>s[w]).replaceAll(`
`,"<br />")}),j=m(()=>{const{backgroundImage:s}=o;return s?{backgroundImage:`url(${s})`}:{}}),R=m(()=>{const{backgroundImage:s}=o;return s?"backdrop-brightness-50":""}),O=async()=>{if(!navigator.clipboard){i.value="您的瀏覽器不支援複製功能";return}try{await navigator.clipboard.writeText(p.value),i.value="已複製代碼",y.value=!0,setTimeout(()=>{y.value=!1},3e3)}catch(s){i.value="無法複製代碼",console.error(s)}},N=()=>{window.open(o.pageUrl,"_blank")},H=async()=>{if(!b.value){i.value="尚未完成系統驗證";return}f.value=!0;const s=await d.post("submissions",{json:{captcha:b.value,roomCode:_}}).json();p.value=s.code,f.value=!1};return K(async()=>{var s;v.value=!0;try{const e=await d.get(`rooms/${_}`).json();Object.assign(o,e)}catch(e){k.value=((s=e.response)==null?void 0:s.status)===404,h.value=!0,console.error(e)}v.value=!1,h.value||(T.render("#captcha"),b.value=await T.token())}),(s,e)=>(a(),l("div",{style:q(j.value)},[k.value?(a(),l("div",W,e[1]||(e[1]=[t("div",{class:"text-center text-amber-700"}," 社群不存在 ",-1)]))):h.value?(a(),l("div",X,e[2]||(e[2]=[t("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):v.value?(a(),l("div",Z,[t("div",ee,[S(E,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(a(),l("div",{key:3,class:Y(["flex flex-wrap w-full justify-center py-20",R.value])},[t("div",te,[t("div",se,[t("img",{alt:o.label,src:o.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,ae)]),t("h2",oe,[$(C(o.label)+" ",1),t("span",ne,C(g(_)),1)]),A.value?(a(),l("div",le,[e[3]||(e[3]=t("p",{class:"mt-6 text-gray-600"}," 請複製這份代碼，再貼上到OpenChat的審核答案內： ",-1)),t("div",re,[t("input",{value:p.value,class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text",readonly:""},null,8,ie),t("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",onClick:O},[y.value?(a(),x(g(z),{key:0,class:"h-6 w-6"})):(a(),x(g(F),{key:1,class:"h-6 w-6"}))])]),t("div",{class:"flex justify-end mt-8"},[t("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:N}," 前往 OpenChat 界面貼上代碼 ")])])):(a(),l("div",ce,[t("p",{class:"mt-6 text-gray-600",innerHTML:V.value},null,8,ue),e[4]||(e[4]=t("div",{class:"checkbox my-3"},[t("div",{id:"captcha","data-theme":"light"})],-1)),t("div",de,[t("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",disabled:f.value,onClick:H},[f.value?(a(),x(E,{key:0,class:"h-6 w-6 animate-spin"})):(a(),l("span",pe,"加入社群"))],8,fe)])]))])],2)),S(U,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=w=>i.value=w)},null,8,["modelValue"])],4))}};export{he as default};
