import{u as N,_ as x}from"./LoadingCircleIcon-00b4d5cc.js";import{_ as H}from"./ToastModal-2a4434df.js";import{q as E,E as U,x as M,r as i,f as B,e as _,o as s,c as n,a as e,n as D,i as g,h as L,t as T,l as h,k as v,m as K,p as Y}from"./index-2d850295.js";const{VITE_TURNSTILE_SITE_KEY:k}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},$="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=loadTurnstile",y=document.createElement("script");y.setAttribute("src",$);function q(c,u){if(!k)throw new Error("turnstileSiteKey is required for loadTurnstile");document.head.appendChild(y),window.loadTurnstile=()=>{window.turnstile.render(c,{sitekey:k,callback:u})}}function z(){document.head.removeChild(y)}function F(c){if(!c)throw new Error("selector is required for useTurnstile");return new Promise(u=>{E(()=>q(c,u)),U(()=>z())})}const P={key:0,class:"absolute top-36 flex flex-col w-full"},G={key:1,class:"absolute top-36 flex flex-col w-full"},J={class:"flex justify-center my-16"},Q={key:2,class:"absolute top-36 flex w-full justify-center"},W={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},X={class:"flex justify-center md:justify-end -mt-16"},Z=["alt","src"],ee={class:"text-gray-800 text-3xl font-semibold"},te={class:"text-sm font-normal"},se={key:0},oe={class:"w-full my-4 text-gray-600 flex rounded bg-white shadow-md"},le=["value"],ne={key:1},ae=["innerHTML"],re={class:"flex justify-end mt-8"},ie={key:1},fe={__name:"TicketView",setup(c){const u=M(),b=N(),S=F("#captcha"),{roomCode:f}=u.params,a=i(!1),w=i(!1),m=i(!1),r=i(""),p=i(""),d=i(""),l=B({label:"",description:"",backgroundImage:"",pageUrl:""}),I=_(()=>d.value!==""),A=_(()=>{const{description:t}=l;return t==null?void 0:t.replaceAll(`
`,"<br />")}),C=_(()=>{const{backgroundImage:t}=l;return{backgroundImage:`url(${t})`,filter:"brightness(0.3)",height:"100vh"}});S.then(t=>{p.value=t});const V=async()=>{if(!navigator.clipboard){r.value="您的瀏覽器不支援複製功能";return}try{await navigator.clipboard.writeText(d.value),r.value="已複製代碼",m.value=!0,setTimeout(()=>{m.value=!1},3e3)}catch(t){r.value="無法複製代碼",console.error(t)}},j=()=>{window.open(l.pageUrl,"_blank")},R=async()=>{if(!p.value){r.value="尚未完成系統驗證";return}a.value=!0;const t=await b.post("submissions",{json:{captcha:p.value,roomCode:f}}).json();d.value=t.code,a.value=!1};return E(async()=>{a.value=!0;try{const t=await b.get(`rooms/${f}`).json();Object.assign(l,t)}catch(t){w.value=!0,console.error(t)}a.value=!1}),(t,o)=>(s(),n("div",null,[e("div",{style:D(C.value)},null,4),w.value?(s(),n("div",P,o[1]||(o[1]=[e("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):a.value?(s(),n("div",G,[e("div",J,[g(x,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(s(),n("div",Q,[e("div",W,[e("div",X,[e("img",{alt:l.label,src:l.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,Z)]),e("h2",ee,[L(T(l.label)+" ",1),e("span",te,T(h(f)),1)]),I.value?(s(),n("div",se,[o[2]||(o[2]=e("p",{class:"mt-6 text-gray-600"}," 請複製這份代碼，再貼上到OpenChat的審核答案內： ",-1)),e("div",oe,[e("input",{value:d.value,class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text",readonly:""},null,8,le),e("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",onClick:V},[m.value?(s(),v(h(K),{key:0,class:"h-6 w-6"})):(s(),v(h(Y),{key:1,class:"h-6 w-6"}))])]),e("div",{class:"flex justify-end mt-8"},[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:j}," 前往 OpenChat 界面貼上代碼 ")])])):(s(),n("div",ne,[e("p",{class:"mt-6 text-gray-600",innerHTML:A.value},null,8,ae),o[3]||(o[3]=e("div",{class:"checkbox my-3"},[e("div",{id:"captcha","data-theme":"light"})],-1)),e("div",re,[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:R},[a.value?(s(),v(x,{key:0,class:"h-6 w-6 animate-spin"})):(s(),n("span",ie,"加入社群"))])])]))])])),g(H,{modelValue:r.value,"onUpdate:modelValue":o[0]||(o[0]=O=>r.value=O)},null,8,["modelValue"])]))}};export{fe as default};
