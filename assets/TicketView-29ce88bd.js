import{u as H,_ as T}from"./LoadingCircleIcon-c73856b5.js";import{_ as M}from"./ToastModal-012289cd.js";import{G as U,y as L,r as l,f as B,e as p,s as D,o as a,c as r,a as e,i as E,n as K,h as Y,t as S,l as g,k as x,m as $,p as q,q as z}from"./index-7cba14fd.js";const{VITE_TURNSTILE_SITE_KEY:C}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},F="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=loadTurnstile",u=document.createElement("script");u.setAttribute("src",F);function P(n,c){if(!C)throw new Error("turnstileSiteKey is required for loadTurnstile");if(!n)throw new Error("selector is required for loadTurnstile");document.head.contains(u)||document.head.appendChild(u),window.loadTurnstile=()=>{window.turnstile.render(n,{sitekey:C,callback:c})}}function G(){document.head.contains(u)&&document.head.removeChild(u)}function J(){U(()=>G());let n=null;return{render:c=>{n=new Promise(d=>{P(c,d)})},token:()=>n,clear:()=>{n=null}}}const Q={key:0,class:"flex flex-wrap w-full justify-center bg-white py-20"},W={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},X={class:"flex justify-center my-16"},Z={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},ee={class:"flex justify-center md:justify-end -mt-16"},te=["alt","src"],se={class:"text-gray-800 text-3xl font-semibold"},ae={class:"text-sm font-normal"},oe={key:0},ne={class:"w-full my-4 text-gray-600 flex rounded bg-white shadow-md"},le=["value"],re={key:1},ie=["innerHTML"],ce={class:"flex justify-end mt-8"},ue={key:1},me={__name:"TicketView",setup(n){const c=L(),d=H(),k=J(),{roomCode:m}=c.params,_=l(!1),y=l(!1),h=l(!1),v=l(!1),i=l(""),b=l(""),f=l(""),o=B({label:"",description:"",backgroundImage:"",pageUrl:""}),I=p(()=>f.value!==""),A=p(()=>{const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},{description:s}=o;return s==null?void 0:s.replace(/[&<>"']/g,w=>t[w]).replaceAll(`
`,"<br />")}),V=p(()=>{const{backgroundImage:t}=o;return t?{backgroundImage:`url(${t})`}:{}}),j=p(()=>{const{backgroundImage:t}=o;return t?"backdrop-brightness-50":""}),R=async()=>{if(!navigator.clipboard){i.value="您的瀏覽器不支援複製功能";return}try{await navigator.clipboard.writeText(f.value),i.value="已複製代碼",v.value=!0,setTimeout(()=>{v.value=!1},3e3)}catch(t){i.value="無法複製代碼",console.error(t)}},O=()=>{window.open(o.pageUrl,"_blank")},N=async()=>{if(!b.value){i.value="尚未完成系統驗證";return}h.value=!0;const t=await d.post("submissions",{json:{captcha:b.value,roomCode:m}}).json();f.value=t.code,h.value=!1};return D(async()=>{_.value=!0;try{const t=await d.get(`rooms/${m}`).json();Object.assign(o,t)}catch(t){y.value=!0,console.error(t)}_.value=!1,y.value||(k.render("#captcha"),b.value=await k.token())}),(t,s)=>(a(),r("div",{style:$(V.value)},[y.value?(a(),r("div",Q,s[1]||(s[1]=[e("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):_.value?(a(),r("div",W,[e("div",X,[E(T,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(a(),r("div",{key:2,class:K(["flex flex-wrap w-full justify-center py-20",j.value])},[e("div",Z,[e("div",ee,[e("img",{alt:o.label,src:o.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,te)]),e("h2",se,[Y(S(o.label)+" ",1),e("span",ae,S(g(m)),1)]),I.value?(a(),r("div",oe,[s[2]||(s[2]=e("p",{class:"mt-6 text-gray-600"}," 請複製這份代碼，再貼上到OpenChat的審核答案內： ",-1)),e("div",ne,[e("input",{value:f.value,class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text",readonly:""},null,8,le),e("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",onClick:R},[v.value?(a(),x(g(q),{key:0,class:"h-6 w-6"})):(a(),x(g(z),{key:1,class:"h-6 w-6"}))])]),e("div",{class:"flex justify-end mt-8"},[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:O}," 前往 OpenChat 界面貼上代碼 ")])])):(a(),r("div",re,[e("p",{class:"mt-6 text-gray-600",innerHTML:A.value},null,8,ie),s[3]||(s[3]=e("div",{class:"checkbox my-3"},[e("div",{id:"captcha","data-theme":"light"})],-1)),e("div",ce,[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:N},[h.value?(a(),x(T,{key:0,class:"h-6 w-6 animate-spin"})):(a(),r("span",ue,"加入社群"))])])]))])],2)),E(M,{modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=w=>i.value=w)},null,8,["modelValue"])],4))}};export{me as default};
