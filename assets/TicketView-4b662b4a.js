import{u as j,_ as R}from"./LoadingCircleIcon-b3e772d0.js";import{_ as O}from"./ToastModal-405cefdc.js";import{q as T,E as N,x as H,r as i,f as U,e as _,o,c as u,a as e,n as M,h as B,t as w,l as h,k as b,i as L,m as D,p as K}from"./index-c1e4986d.js";const{VITE_TURNSTILE_SITE_KEY:g}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Y="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=loadTurnstile",v=document.createElement("script");v.setAttribute("src",Y);function $(l,r){if(!g)throw new Error("turnstileSiteKey is required for loadTurnstile");document.head.appendChild(v),window.loadTurnstile=()=>{window.turnstile.render(l,{sitekey:g,callback:r})}}function q(){document.head.removeChild(v)}function z(l){if(!l)throw new Error("selector is required for useTurnstile");return new Promise(r=>{T(()=>$(l,r)),N(()=>q())})}const F={class:"absolute top-36 flex w-full justify-center"},P={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},G={class:"flex justify-center md:justify-end -mt-16"},J=["alt","src"],Q={class:"text-gray-800 text-3xl font-semibold"},W={class:"text-sm font-normal"},X={key:0},Z={class:"w-full my-4 text-gray-600 flex rounded bg-white shadow-md"},ee=["value"],te={key:1},se=["innerHTML"],oe={class:"flex justify-end mt-8"},ne={key:1},ie={__name:"TicketView",setup(l){const r=H(),y=j(),x=z("#captcha"),{roomCode:d}=r.params,m=i(!1),p=i(!1),n=i(""),f=i(""),c=i(""),s=U({label:"",description:"",backgroundImage:"",pageUrl:""}),E=_(()=>c.value!==""),k=_(()=>{const{description:t}=s;return t==null?void 0:t.replaceAll(`
`,"<br />")}),S=_(()=>{const{backgroundImage:t}=s;return{backgroundImage:`url(${t})`,filter:"brightness(0.3)",height:"100vh"}});x.then(t=>{f.value=t});const I=async()=>{if(!navigator.clipboard){n.value="您的瀏覽器不支援複製功能";return}try{await navigator.clipboard.writeText(c.value),n.value="已複製代碼",p.value=!0,setTimeout(()=>{p.value=!1},3e3)}catch(t){n.value="無法複製代碼",console.error(t)}},A=()=>{window.open(s.pageUrl,"_blank")},C=async()=>{if(!f.value){n.value="尚未完成系統驗證";return}m.value=!0;const t=await y.post("submissions",{json:{captcha:f.value,roomCode:d}}).json();c.value=t.code,m.value=!1};return T(async()=>{const t=await y.get(`rooms/${d}`).json();Object.assign(s,t)}),(t,a)=>(o(),u("div",null,[e("div",{style:M(S.value)},null,4),e("div",F,[e("div",P,[e("div",G,[e("img",{alt:s.label,src:s.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,J)]),e("h2",Q,[B(w(s.label)+" ",1),e("span",W,w(h(d)),1)]),E.value?(o(),u("div",X,[a[1]||(a[1]=e("p",{class:"mt-6 text-gray-600"}," 請複製這份代碼，再貼上到OpenChat的審核答案內： ",-1)),e("div",Z,[e("input",{value:c.value,class:"h-12 w-full border-none bg-transparent px-4 py-1 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text",readonly:""},null,8,ee),e("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",onClick:I},[p.value?(o(),b(h(D),{key:0,class:"h-6 w-6"})):(o(),b(h(K),{key:1,class:"h-6 w-6"}))])]),e("div",{class:"flex justify-end mt-8"},[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:A}," 前往 OpenChat 界面貼上代碼 ")])])):(o(),u("div",te,[e("p",{class:"mt-6 text-gray-600",innerHTML:k.value},null,8,se),a[2]||(a[2]=e("div",{class:"checkbox my-3"},[e("div",{id:"captcha","data-theme":"light"})],-1)),e("div",oe,[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:C},[m.value?(o(),b(R,{key:0,class:"h-6 w-6 animate-spin"})):(o(),u("span",ne,"加入社群"))])])]))])]),L(O,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=V=>n.value=V)},null,8,["modelValue"])]))}};export{ie as default};
