import{u as R,_ as u}from"./LoadingCircleIcon-81a78f19.js";import{_ as z}from"./ToastModal-e44afe09.js";import{z as H,u as S,d as O,h as n,j,i as m,x as U,o,c as a,a as t,l as r,p as g,f as C,n as q,t as L,g as E,r as F}from"./index-e0469f99.js";const P={key:0},G={class:"py-20 text-center"},J={class:"flex justify-center mt-8"},K={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},Q={key:2,class:"flex flex-wrap w-full justify-center bg-white py-20"},W={key:3,class:"flex flex-wrap w-full justify-center bg-white py-20"},X={class:"flex justify-center my-16"},Y={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},Z={class:"flex justify-center md:justify-end -mt-16"},ee=["alt","src"],te={class:"text-gray-800 text-3xl font-semibold"},se={class:"text-sm font-normal"},oe=["innerHTML"],ae={class:"flex justify-end mt-8"},le=["disabled"],ne={key:1},ie=["disabled"],re={key:1},fe={__name:"TicketAdminView",setup(ce){const T=H(),b=S(),f=R(),V=O(),{invitationCode:v}=T.params,$=V!==null,p=n(!1),x=n(!1),h=n(!1),_=n(!1),c=n(!1),d=n(!1),i=n(""),l=j({label:"",description:"",backgroundImage:"",pageUrl:""}),k=j({email:"",roomCode:"",invitationCode:""}),w=m(()=>c.value||d.value),D=m(()=>{const s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"},{description:e}=l;return e==null?void 0:e.replace(/[&<>"']/g,y=>s[y]).replaceAll(`
`,"<br />")}),I=m(()=>{const{backgroundImage:s}=l;return s?{backgroundImage:`url(${s})`}:{}}),M=m(()=>{const{backgroundImage:s}=l;return s?"backdrop-brightness-50":""}),A=()=>{_.value=!0,setTimeout(()=>{F()},1e3)},B=async()=>{c.value=!0;try{await f.patch(`rooms/invitations/${v}`),i.value="接受成功",setTimeout(()=>{b.push(`/rooms/${k.roomCode}`)},1500)}catch(s){i.value="接受失敗",c.value=!1,console.error(s)}},N=async()=>{d.value=!0;try{await f.delete(`rooms/invitations/${v}`),i.value="拒絕成功",setTimeout(()=>{b.push("/")},1500)}catch(s){i.value="拒絕失敗",d.value=!1,console.error(s)}};return U(async()=>{var s;p.value=!0;try{const e=await f.get(`rooms/invitations/${v}`).json();Object.assign(l,e.room),Object.assign(k,e.invitation)}catch(e){h.value=((s=e.response)==null?void 0:s.status)===404,x.value=!0,console.error(e)}p.value=!1}),(s,e)=>(o(),a("div",{style:E(I.value)},[$?h.value?(o(),a("div",K,e[4]||(e[4]=[t("div",{class:"text-center text-amber-700"}," 邀請已失效 ",-1)]))):x.value?(o(),a("div",Q,e[5]||(e[5]=[t("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):p.value?(o(),a("div",W,[t("div",X,[C(u,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(o(),a("div",{key:4,class:q(["flex flex-wrap w-full justify-center py-20",M.value])},[t("div",Y,[t("div",Z,[t("img",{alt:l.label,src:l.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,ee)]),t("h2",te,[r(L(l.label)+" ",1),t("span",se,L(s.roomCode),1)]),t("p",{class:"mt-6 text-gray-600",innerHTML:D.value},null,8,oe),e[6]||(e[6]=t("div",{class:"checkbox my-3"},[t("div",{id:"captcha","data-theme":"light"})],-1)),t("div",ae,[t("button",{class:"flex items-center justify-center bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-full mr-3",disabled:w.value,onClick:B},[c.value?(o(),g(u,{key:0,class:"h-6 w-6 animate-spin"})):(o(),a("span",ne," 接受 "))],8,le),t("button",{class:"flex items-center justify-center bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",disabled:w.value,onClick:N},[d.value?(o(),g(u,{key:0,class:"h-6 w-6 animate-spin"})):(o(),a("span",re," 拒絕 "))],8,ie)])])],2)):(o(),a("div",P,[t("div",G,[e[1]||(e[1]=t("div",{class:"text-red-500 text-xl font-bold"}," 尚未登入 ",-1)),e[2]||(e[2]=t("div",{class:"mt-4 text-gray-700"},[r(" 請使用您所受到邀請的電子郵件地址註冊或登入，以接受邀請。"),t("br"),r(" 若非使用邀請函應對的電子郵件地址，本頁面將無法存取。 ")],-1)),e[3]||(e[3]=t("div",{class:"mt-4 text-gray-700"},[r(" 如果這個電子郵件不是您主要使用的電子郵件地址，"),t("br"),r(" 請聯絡邀請您的使用者重新發送邀請函。 ")],-1)),t("div",J,[_.value?(o(),g(u,{key:0,class:"h-8 w-8 animate-spin text-lime-600"})):(o(),a("button",{key:1,class:"flex items-center justify-center bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-full",onClick:A}," 我明白了，前往登入 "))])])])),C(z,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=y=>i.value=y)},null,8,["modelValue"])],4))}};export{fe as default};
