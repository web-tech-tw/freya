import{u as F,_ as u}from"./LoadingCircleIcon-a03cdcee.js";import{_ as S}from"./ToastModal-1557e42a.js";import{z as M,u as O,d as U,h as n,j as C,i as m,x as E,o as s,c as a,a as t,l as r,p as g,f as L,n as P,t as b,F as q,y as G,g as H,r as J}from"./index-72055197.js";const K={key:0},Q={class:"py-20 text-center"},W={class:"flex justify-center mt-8"},X={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},Y={key:2,class:"flex flex-wrap w-full justify-center bg-white py-20"},Z={key:3,class:"flex flex-wrap w-full justify-center bg-white py-20"},ee={class:"flex justify-center my-16"},te={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},se={class:"flex justify-center md:justify-end -mt-16"},oe=["alt","src"],ae={class:"text-gray-800 text-3xl font-semibold"},le={class:"text-sm font-normal"},ne={class:"mt-6 text-gray-600"},ie={class:"flex justify-end mt-8"},re=["disabled"],ce={key:1},de=["disabled"],ue={key:1},ye={__name:"TicketAdminView",setup(me){const V=M(),x=O(),f=F(),$=U(),{invitationCode:v}=V.params,D=$!==null,p=n(!1),h=n(!1),_=n(!1),k=n(!1),c=n(!1),d=n(!1),i=n(""),l=C({label:"",description:"",backgroundImage:"",pageUrl:""}),w=C({email:"",roomCode:"",invitationCode:""}),j=m(()=>c.value||d.value),I=m(()=>l.description.split(`
`)),T=m(()=>{const{backgroundImage:o}=l;return o?{backgroundImage:`url(${o})`}:{}}),B=m(()=>{const{backgroundImage:o}=l;return o?"backdrop-brightness-50":""}),N=()=>{k.value=!0,setTimeout(()=>{J(!0)},1e3)},R=async()=>{c.value=!0;try{await f.patch(`rooms/invitations/${v}`),i.value="接受成功",setTimeout(()=>{x.push(`/rooms/${w.roomCode}`)},1500)}catch(o){i.value="接受失敗",c.value=!1,console.error(o)}},z=async()=>{d.value=!0;try{await f.delete(`rooms/invitations/${v}`),i.value="拒絕成功",setTimeout(()=>{x.push("/")},1500)}catch(o){i.value="拒絕失敗",d.value=!1,console.error(o)}};return E(async()=>{var o;p.value=!0;try{const e=await f.get(`rooms/invitations/${v}`).json();Object.assign(l,e.room),Object.assign(w,e.invitation)}catch(e){_.value=((o=e.response)==null?void 0:o.status)===404,h.value=!0,console.error(e)}p.value=!1}),(o,e)=>(s(),a("div",{style:H(T.value)},[D?_.value?(s(),a("div",X,e[4]||(e[4]=[t("div",{class:"text-center text-amber-700"}," 邀請已失效 ",-1)]))):h.value?(s(),a("div",Y,e[5]||(e[5]=[t("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):p.value?(s(),a("div",Z,[t("div",ee,[L(u,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(s(),a("div",{key:4,class:P(["flex flex-wrap w-full justify-center py-20",B.value])},[t("div",te,[t("div",se,[t("img",{alt:l.label,src:l.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,oe)]),t("h2",ae,[r(b(l.label)+" ",1),t("span",le,b(o.roomCode),1)]),t("p",ne,[(s(!0),a(q,null,G(I.value,(y,A)=>(s(),a("span",{key:A},[r(b(y),1),e[6]||(e[6]=t("br",null,null,-1))]))),128))]),e[7]||(e[7]=t("div",{class:"checkbox my-3"},[t("div",{id:"captcha","data-theme":"light"})],-1)),t("div",ie,[t("button",{class:"flex items-center justify-center bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-full mr-3",disabled:j.value,onClick:R},[c.value?(s(),g(u,{key:0,class:"h-6 w-6 animate-spin"})):(s(),a("span",ce," 接受 "))],8,re),t("button",{class:"flex items-center justify-center bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full",disabled:j.value,onClick:z},[d.value?(s(),g(u,{key:0,class:"h-6 w-6 animate-spin"})):(s(),a("span",ue," 拒絕 "))],8,de)])])],2)):(s(),a("div",K,[t("div",Q,[e[1]||(e[1]=t("div",{class:"text-red-500 text-xl font-bold"}," 尚未登入 ",-1)),e[2]||(e[2]=t("div",{class:"mt-4 text-gray-700"},[r(" 請使用您所受到邀請的電子郵件地址註冊或登入，以接受邀請。"),t("br"),r(" 若非使用邀請函應對的電子郵件地址，本頁面將無法存取。 ")],-1)),e[3]||(e[3]=t("div",{class:"mt-4 text-gray-700"},[r(" 如果這個電子郵件不是您主要使用的電子郵件地址，"),t("br"),r(" 請聯絡邀請您的使用者重新發送邀請函。 ")],-1)),t("div",W,[k.value?(s(),g(u,{key:0,class:"h-8 w-8 animate-spin text-lime-600"})):(s(),a("button",{key:1,class:"flex items-center justify-center bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-full",onClick:N}," 我明白了，前往登入 "))])])])),L(S,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=y=>i.value=y)},null,8,["modelValue"])],4))}};export{ye as default};
