import{u as B,_ as S}from"./LoadingCircleIcon-a03cdcee.js";import{_ as D}from"./ToastModal-1557e42a.js";import{K as H,z as Y,h as l,j as F,i as m,x as M,o as s,c as o,a as e,f as A,n as $,l as I,t as x,e as g,p as T,F as z,y as q,g as P,q as G,s as J}from"./index-72055197.js";const{VITE_TURNSTILE_SITE_KEY:C}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_TYPE:"SARA",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Q="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=loadTurnstile",c=document.createElement("script");c.setAttribute("src",Q);function W(r,u){if(!C)throw new Error("turnstileSiteKey is required for loadTurnstile");if(!r)throw new Error("selector is required for loadTurnstile");document.head.contains(c)||document.head.appendChild(c),window.loadTurnstile=()=>{window.turnstile.render(r,{sitekey:C,callback:u})}}function X(){document.head.contains(c)&&document.head.removeChild(c)}function Z(){H(()=>X());let r=null;return{render:u=>{r=new Promise(d=>{W(u,d)})},token:()=>r,clear:()=>{r=null}}}const ee={key:0,class:"flex flex-wrap w-full justify-center bg-white py-20"},te={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},se={key:2,class:"flex flex-wrap w-full justify-center bg-white py-20"},ae={class:"flex justify-center my-16"},oe={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},ne={class:"flex justify-center md:justify-end -mt-16"},le=["alt","src"],re={class:"text-gray-800 text-3xl font-semibold"},ie={class:"text-sm font-normal"},ue={key:0},ce={class:"w-full my-4 text-gray-600 flex rounded bg-white shadow-md"},de=["value"],fe={key:1},pe={class:"mt-6 text-gray-600"},me={class:"flex justify-end mt-8"},_e=["disabled"],ve={key:1},we={__name:"TicketRoomView",setup(r){const u=Y(),d=B(),k=Z(),{roomCode:_}=u.params,v=l(!1),y=l(!1),E=l(!1),f=l(!1),b=l(!1),i=l(""),h=l(""),p=l(""),n=F({label:"",description:"",backgroundImage:"",pageUrl:""}),V=m(()=>p.value!==""),j=m(()=>n.description.split(`
`)),R=m(()=>{const{backgroundImage:a}=n;return a?{backgroundImage:`url(${a})`}:{}}),O=m(()=>{const{backgroundImage:a}=n;return a?"backdrop-brightness-50":""}),N=async()=>{if(!navigator.clipboard){i.value="您的瀏覽器不支援複製功能";return}try{await navigator.clipboard.writeText(p.value),i.value="已複製代碼",b.value=!0,setTimeout(()=>{b.value=!1},3e3)}catch(a){i.value="無法複製代碼",console.error(a)}},U=()=>{window.open(n.pageUrl,"_blank")},K=async()=>{if(!h.value){i.value="尚未完成系統驗證";return}f.value=!0;const a=await d.post("submissions",{json:{captcha:h.value,roomCode:_}}).json();p.value=a.code,f.value=!1};return M(async()=>{var a;v.value=!0;try{const t=await d.get(`rooms/${_}`).json();Object.assign(n,t)}catch(t){E.value=((a=t.response)==null?void 0:a.status)===404,y.value=!0,console.error(t)}v.value=!1,y.value||(k.render("#captcha"),h.value=await k.token())}),(a,t)=>(s(),o("div",{style:P(R.value)},[E.value?(s(),o("div",ee,t[1]||(t[1]=[e("div",{class:"text-center text-amber-700"}," 社群不存在 ",-1)]))):y.value?(s(),o("div",te,t[2]||(t[2]=[e("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):v.value?(s(),o("div",se,[e("div",ae,[A(S,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(s(),o("div",{key:3,class:$(["flex flex-wrap w-full justify-center py-20",O.value])},[e("div",oe,[e("div",ne,[e("img",{alt:n.label,src:n.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,le)]),e("h2",re,[I(x(n.label)+" ",1),e("span",ie,x(g(_)),1)]),V.value?(s(),o("div",ue,[t[3]||(t[3]=e("p",{class:"mt-6 text-gray-600"}," 請複製這份代碼，再貼上到OpenChat的審核答案內： ",-1)),e("div",ce,[e("input",{value:p.value,class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text",readonly:""},null,8,de),e("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",onClick:N},[b.value?(s(),T(g(G),{key:0,class:"h-6 w-6"})):(s(),T(g(J),{key:1,class:"h-6 w-6"}))])]),e("div",{class:"flex justify-end mt-8"},[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:U}," 前往 OpenChat 界面貼上代碼 ")])])):(s(),o("div",fe,[e("p",pe,[(s(!0),o(z,null,q(j.value,(w,L)=>(s(),o("span",{key:L},[I(x(w),1),t[4]||(t[4]=e("br",null,null,-1))]))),128))]),t[5]||(t[5]=e("div",{class:"checkbox my-3"},[e("div",{id:"captcha","data-theme":"light"})],-1)),e("div",me,[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",disabled:f.value,onClick:K},[f.value?(s(),T(S,{key:0,class:"h-6 w-6 animate-spin"})):(s(),o("span",ve,"加入社群"))],8,_e)])]))])],2)),A(D,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=w=>i.value=w)},null,8,["modelValue"])],4))}};export{we as default};
