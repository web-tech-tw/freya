import{z as j,u as O,d as N,h as _,j as U,i as E,x as H,o as r,c as l,a as t,f as b,n as A,l as D,t as k,e as f,m as P,v as B,p as S,F as M,y as Y,g as F,q as K,H as L,B as z,I as q,J as G}from"./index-4ff96ecc.js";import{k as J,u as Q,_ as W}from"./LoadingCircleIcon-c8220e3f.js";import{_ as X}from"./ToastModal-2b6577cf.js";const{VITE_SARA_RECV_HOST:Z,VITE_SARA_TOKEN_TYPE:ee}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_RECV_HOST:"https://web-tech.tw/recv/sara",VITE_SARA_TOKEN_TYPE:"SARA",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},te=()=>J.create({prefixUrl:Z}),V=(p,n=80)=>`https://api.gravatar.com/avatar/${p}?d=identicon&s=${n}`,se=async(p,n,v=80)=>{if(ee==="TEST"){const d=n.substring(0,8),h=V(n,v);return{id:n,nickname:d,avatarUrl:h}}const u=await p.get(`users/${n}`).json(),{nickname:x,avatar_hash:y}=u.profile,i=V(y,v);return{id:n,nickname:x,avatarUrl:i}},ae={key:0,class:"flex flex-wrap w-full justify-center bg-white py-20"},re={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},oe={class:"flex justify-center my-16"},ne={class:"max-w-md lg:w-1/3 py-4 px-8 bg-white shadow-lg rounded-lg my-20"},le={class:"flex justify-center md:justify-end -mt-16"},ce=["alt","src"],ie={class:"text-gray-800 text-3xl font-semibold"},ue={class:"text-sm font-normal"},de={class:"w-full mb-4 text-gray-600 flex rounded bg-white shadow-md"},me=["disabled"],_e={class:"mt-4 mb-6"},fe=["onClick"],pe=["alt","src"],ve={class:"mx-4"},ye={key:0,class:"text-gray-500"},he={key:0,title:"主管理員"},we={key:1,title:"共同管理員"},Te={__name:"RoomAdminView",setup(p){const n=j(),v=O(),u=Q(),x=te(),y=N(),{roomCode:i}=n.params,d=_(!1),h=_(!1),w=_(!1),c=_(""),m=_(""),o=U({code:"",label:"",backgroundImage:"",creator:{},administrators:[]}),C=E(()=>{const{backgroundImage:s}=o;return s?{backgroundImage:`url(${s})`}:{}}),R=E(()=>{const{backgroundImage:s}=o;return s?"backdrop-brightness-50":""}),I=async()=>{if(!m.value){c.value="請輸入電子郵件";return}w.value=!0;try{await u.post(`rooms/${i}/administrators`,{json:{email:m.value}}),c.value="已發送邀請函",m.value=""}catch(s){c.value="發送邀請函失敗",console.error(s)}w.value=!1},$=async(s,a)=>{if(!a&&confirm("確定要移除該管理員？"))try{await u.delete(`rooms/${i}/administrators/${s}`),s===y._id?(c.value="已將您移除出管理員",setTimeout(()=>{v.push("/")},3e3)):(c.value="已移除該管理員",o.administrators=o.administrators.filter(e=>e.id!==s))}catch(e){c.value="移除管理員失敗",console.error(e)}};return H(async()=>{d.value=!0;try{const s=await u.get(`rooms/${i}`).json();Object.assign(o,s);const{creator:a,administrators:e}=s;o.administrators=await Promise.all(e.map(async g=>{const T=await se(x,g);return T.isSelf=g===y._id,T.isCreator=g===a,T}))}catch(s){h.value=!0,console.error(s)}d.value=!1}),(s,a)=>(r(),l("div",{style:F(C.value)},[h.value?(r(),l("div",ae,a[2]||(a[2]=[t("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):d.value?(r(),l("div",re,[t("div",oe,[b(W,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(r(),l("div",{key:2,class:A(["flex flex-wrap w-full justify-center py-20",R.value])},[t("div",ne,[t("div",le,[t("img",{alt:o.label,src:o.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,ce)]),t("div",null,[t("h2",ie,[D(k(o.label)+" ",1),t("span",ue,k(f(i)),1)])]),a[3]||(a[3]=t("p",{class:"mt-4 text-gray-600"}," 傳送管理員邀請函： ",-1)),t("div",de,[P(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),placeholder:"freya@web-tech.tw",class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text"},null,512),[[B,m.value]]),t("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",disabled:w.value,onClick:I},[w.value?(r(),S(f(K),{key:0,class:"h-6 w-6"})):(r(),S(f(L),{key:1,class:"h-6 w-6"}))],8,me)]),a[4]||(a[4]=t("p",{class:"mt-6 text-gray-600"}," 現有管理員： ",-1)),t("ul",_e,[(r(!0),l(M,null,Y(o.administrators,e=>(r(),l("li",{key:e.id,class:A([{"cursor-pointer":!e.isCreator,"hover:bg-gray-300":!e.isCreator},"rounded-md flex flex-1 items-center px-4 py-2 my-1 justify-between"]),onClick:g=>$(e.id,e.isCreator)},[t("img",{alt:e.nickname,src:e.avatarUrl,class:"h-8 w-8 rounded-full object-cover"},null,8,pe),t("div",ve,[t("span",null,k(e.nickname),1),e.isSelf?(r(),l("span",ye," (您) ")):z("",!0)]),e.isCreator?(r(),l("div",he,[b(f(q),{class:"h-6 w-6"})])):(r(),l("div",we,[b(f(G),{class:"h-6 w-6"})]))],10,fe))),128))])])],2)),b(X,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e)},null,8,["modelValue"])],4))}};export{Te as default};
