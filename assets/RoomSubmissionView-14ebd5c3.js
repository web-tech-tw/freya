import{y as S,r as i,f as C,e as v,z as I,s as N,o,c as l,a as e,i as c,n as z,h as b,t as u,l as m,j as L,v as M,k as w,A as V,m as E,B as O,C as R,D as T,E as U}from"./index-7cba14fd.js";import{u as Q,_ as h}from"./LoadingCircleIcon-c73856b5.js";import{_ as q}from"./ToastModal-012289cd.js";const F={key:0,class:"flex flex-wrap w-full justify-center bg-white py-20"},G={key:1,class:"flex flex-wrap w-full justify-center bg-white py-20"},H={class:"flex justify-center my-16"},J={class:"w-full flex justify-center"},K={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg mt-20 mb-8"},P={class:"flex justify-center md:justify-end -mt-16"},W=["alt","src"],X={class:"text-gray-800 text-3xl font-semibold"},Y={class:"text-sm font-normal"},Z={class:"w-full mb-4 text-gray-600 flex rounded bg-white shadow-md"},ee={key:0,class:"w-full flex justify-center"},se={key:0,class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg mb-20"},te={key:1,class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg mb-20"},oe={class:"flex justify-center my-2"},ae={class:"my-4 text-gray-600"},le={class:"font-normal"},ne={key:0,class:"my-4 text-gray-600"},re={key:2,class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg mb-20"},de={class:"flex justify-center my-2"},ie={class:"my-4 text-gray-600"},ce={class:"font-normal"},pe={__name:"RoomSubmissionView",setup(ue){const $=S(),_=Q(),{roomCode:f}=$.params,p=i(!1),k=i(!1),y=i(!1),n=i(!1),g=i(""),r=i(""),d=C({label:"",description:"",backgroundImage:""}),a=C({code:"",roomCode:"",createdAt:"",updatedAt:""}),j=v(()=>n.value&&a.roomCode===f),B=v(()=>{const{backgroundImage:t}=d;return t?{backgroundImage:`url(${t})`}:{}}),D=v(()=>{const{backgroundImage:t}=d;return t?"backdrop-brightness-50":""});I(r,t=>{t!==a.code&&(n.value=!1,a.code="",a.roomCode="")});const A=async()=>{if(!r.value){g.value="請輸入驗證碼";return}if(n.value){r.value="";return}a.code=r.value,y.value=!0,n.value=!0;try{const t=await _.get(`rooms/${f}/submissions/${a.code}`).json();Object.assign(a,t)}catch(t){console.error(t)}y.value=!1};return N(async()=>{p.value=!0;try{const t=await _.get(`rooms/${f}`).json();Object.assign(d,t)}catch(t){k.value=!0,console.error(t)}p.value=!1}),(t,s)=>(o(),l("div",{style:E(B.value)},[k.value?(o(),l("div",F,s[2]||(s[2]=[e("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):p.value?(o(),l("div",G,[e("div",H,[c(h,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(o(),l("div",{key:2,class:z(["flex flex-wrap w-full justify-center py-20",D.value])},[e("div",J,[e("div",K,[e("div",P,[e("img",{alt:d.label,src:d.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,W)]),e("h2",X,[b(u(d.label)+" ",1),e("span",Y,u(m(f)),1)]),s[3]||(s[3]=e("p",{class:"mt-6 text-gray-600"}," 社群加入申請管理系統 ",-1)),s[4]||(s[4]=e("p",{class:"mt-6 text-gray-600"}," 請輸入對方提供的驗證碼： ",-1)),e("div",Z,[L(e("input",{"onUpdate:modelValue":s[0]||(s[0]=x=>r.value=x),placeholder:"pmShBo2Bg",class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text"},null,512),[[M,r.value]]),e("button",{class:"m-2 rounded px-4 py-2 font-semibold",onClick:A},[y.value?(o(),w(h,{key:0,class:"h-6 w-6 animate-spin"})):n.value?(o(),w(m(O),{key:1,class:"h-6 w-6"})):(o(),w(m(R),{key:2,class:"h-6 w-6"}))])])])]),n.value?(o(),l("div",ee,[y.value?(o(),l("div",se,[c(h,{class:"w-14 h-14 animate-spin"})])):j.value?(o(),l("div",te,[e("div",oe,[c(m(T),{class:"w-14 h-14 rounded-full bg-white border-2 border-white-500"})]),s[6]||(s[6]=e("h3",{class:"text-gray-800 text-xl font-semibold"}," 驗證碼有效 ",-1)),e("p",ae,[s[5]||(s[5]=b(" 驗證碼： ")),e("span",le,u(a.code),1)]),j.value?(o(),l("p",ne," 申請時間："+u(new Date(a.createdAt).toLocaleString()),1)):V("",!0)])):(o(),l("div",re,[e("div",de,[c(m(U),{class:"w-14 h-14 rounded-full bg-white border-2 border-white-500"})]),s[8]||(s[8]=e("h3",{class:"text-gray-800 text-xl font-semibold"}," 驗證碼無效 ",-1)),e("p",ie,[s[7]||(s[7]=b(" 驗證碼： ")),e("span",ce,u(a.code),1)])]))])):V("",!0)],2)),c(q,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=x=>g.value=x)},null,8,["modelValue"])],4))}};export{pe as default};
