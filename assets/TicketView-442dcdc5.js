import{u as N,_ as T}from"./LoadingCircleIcon-83a13acb.js";import{_ as H}from"./ToastModal-d7eba799.js";import{E as U,x as L,r as a,f as M,e as b,q as B,o as s,c as r,a as e,n as D,i as k,h as K,t as E,l as w,k as x,m as Y,p as $}from"./index-e8cc82c4.js";const{VITE_TURNSTILE_SITE_KEY:S}={VITE_HOME_INTE_HOST:"https://web-tech.tw",VITE_SARA_INTE_HOST:"https://web-tech.tw/sara",VITE_SARA_TOKEN_NAME:"unified_token",VITE_FREYA_INTE_HOST:"https://web-tech.tw/freya",VITE_FREYA_RECV_HOST:"https://web-tech.tw/recv/freya",VITE_TURNSTILE_SITE_KEY:"0x4AAAAAAAz8kwCfcwYC8fgp",BASE_URL:"/freya/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},q="https://challenges.cloudflare.com/turnstile/v0/api.js?onload=loadTurnstile",c=document.createElement("script");c.setAttribute("src",q);function z(l,u){if(!S)throw new Error("turnstileSiteKey is required for loadTurnstile");if(!l)throw new Error("selector is required for loadTurnstile");document.head.contains(c)||document.head.appendChild(c),window.loadTurnstile=()=>{window.turnstile.render(l,{sitekey:S,callback:u})}}function F(){document.head.contains(c)&&document.head.removeChild(c)}function P(){U(()=>F());let l=null;return{render:u=>{l=new Promise(d=>{z(u,d)})},token:()=>l,clear:()=>{l=null}}}const G={key:0,class:"absolute top-36 flex flex-col w-full"},J={key:1,class:"absolute top-36 flex flex-col w-full"},Q={class:"flex justify-center my-16"},W={key:2,class:"absolute top-36 flex w-full justify-center"},X={class:"max-w-md py-4 px-8 bg-white shadow-lg rounded-lg my-20"},Z={class:"flex justify-center md:justify-end -mt-16"},ee=["alt","src"],te={class:"text-gray-800 text-3xl font-semibold"},se={class:"text-sm font-normal"},oe={key:0},le={class:"w-full my-4 text-gray-600 flex rounded bg-white shadow-md"},ne=["value"],ae={key:1},re=["innerHTML"],ie={class:"flex justify-end mt-8"},ue={key:1},me={__name:"TicketView",setup(l){const u=L(),d=N(),g=P(),{roomCode:m}=u.params,p=a(!1),_=a(!1),h=a(!1),v=a(!1),i=a(""),y=a(""),f=a(""),n=M({label:"",description:"",backgroundImage:"",pageUrl:""}),I=b(()=>f.value!==""),A=b(()=>{const{description:t}=n;return t==null?void 0:t.replaceAll(`
`,"<br />")}),C=b(()=>{const{backgroundImage:t}=n;return{backgroundImage:`url(${t})`,filter:"brightness(0.3)",height:"100vh"}}),V=async()=>{if(!navigator.clipboard){i.value="您的瀏覽器不支援複製功能";return}try{await navigator.clipboard.writeText(f.value),i.value="已複製代碼",v.value=!0,setTimeout(()=>{v.value=!1},3e3)}catch(t){i.value="無法複製代碼",console.error(t)}},j=()=>{window.open(n.pageUrl,"_blank")},R=async()=>{if(!y.value){i.value="尚未完成系統驗證";return}h.value=!0;const t=await d.post("submissions",{json:{captcha:y.value,roomCode:m}}).json();f.value=t.code,h.value=!1};return B(async()=>{p.value=!0;try{const t=await d.get(`rooms/${m}`).json();Object.assign(n,t)}catch(t){_.value=!0,console.error(t)}p.value=!1,_.value||(g.render("#captcha"),y.value=await g.token())}),(t,o)=>(s(),r("div",null,[e("div",{style:D(C.value)},null,4),_.value?(s(),r("div",G,o[1]||(o[1]=[e("div",{class:"text-center text-red-500"}," 發生錯誤 ",-1)]))):p.value?(s(),r("div",J,[e("div",Q,[k(T,{class:"h-8 w-8 animate-spin text-lime-600"})])])):(s(),r("div",W,[e("div",X,[e("div",Z,[e("img",{alt:n.label,src:n.backgroundImage,class:"w-20 h-20 object-cover rounded-full border-2 border-white-500"},null,8,ee)]),e("h2",te,[K(E(n.label)+" ",1),e("span",se,E(w(m)),1)]),I.value?(s(),r("div",oe,[o[2]||(o[2]=e("p",{class:"mt-6 text-gray-600"}," 請複製這份代碼，再貼上到OpenChat的審核答案內： ",-1)),e("div",le,[e("input",{value:f.value,class:"w-full border-none bg-transparent px-4 py-3 text-gray-900 outline-none focus:outline-none text-gray-500",type:"text",readonly:""},null,8,ne),e("button",{title:"複製",class:"m-2 rounded px-4 py-2 font-semibold",onClick:V},[v.value?(s(),x(w(Y),{key:0,class:"h-6 w-6"})):(s(),x(w($),{key:1,class:"h-6 w-6"}))])]),e("div",{class:"flex justify-end mt-8"},[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:j}," 前往 OpenChat 界面貼上代碼 ")])])):(s(),r("div",ae,[e("p",{class:"mt-6 text-gray-600",innerHTML:A.value},null,8,re),o[3]||(o[3]=e("div",{class:"checkbox my-3"},[e("div",{id:"captcha","data-theme":"light"})],-1)),e("div",ie,[e("button",{class:"flex items-center justify-center bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full",onClick:R},[h.value?(s(),x(T,{key:0,class:"h-6 w-6 animate-spin"})):(s(),r("span",ue,"加入社群"))])])]))])])),k(H,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=O=>i.value=O)},null,8,["modelValue"])]))}};export{me as default};
